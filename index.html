<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IIS Mendel · Piano delle Attività 2025-2026</title>
  <meta name="description" content="Piano delle Attività scolastico IIS Mendel - Anno Scolastico 2025/2026">
  <style>
    :root{
      --bg: #ffffff;
      --panel: #f8fafc;
      --text: #111827;
      --muted: #6b7280;
      --border: 1px solid rgba(0,0,0,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.15);
      --chip: rgba(0,0,0,.04);
      --chip-border: 1px solid rgba(0,0,0,.08);
      --accent: #4CAF50;
      --accent-2: #2e7d32;
      --red: #ef4444;
      --blue: #3b82f6;
      --amber: #f59e0b;
      --purple: #8b5cf6;
      --card: #ffffff;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { 
      margin: 0; 
      background: var(--bg); 
      color: var(--text); 
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; 
      line-height: 1.5;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 16px; }
    
    /* Header */
    .topbar { 
      position: sticky; 
      top: 0; 
      z-index: 50; 
      background: var(--panel); 
      border-bottom: var(--border); 
      box-shadow: var(--shadow);
    }
    .top-inner { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
      justify-content: space-between; 
      max-width: 1400px; 
      margin: 0 auto; 
      padding: 12px 16px;
      flex-wrap: wrap;
    }
    .brand { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      font-weight: 800; 
      font-size: 18px;
    }
    .brand .dot { 
      width: 12px; 
      height: 12px; 
      border-radius: 50%; 
      background: var(--accent); 
      box-shadow: 0 0 0 4px rgba(76,175,80,.18);
    }
    .controls { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      flex-wrap: wrap;
    }
    .btn { 
      border: none; 
      border-radius: 12px; 
      padding: 10px 14px; 
      cursor: pointer; 
      font-weight: 600; 
      background: var(--panel); 
      color: var(--text); 
      border: var(--border);
      transition: all 0.2s ease;
    }
    .btn:hover { filter: brightness(1.08); }
    .btn-accent { background: linear-gradient(135deg, #4CAF50, #45a049); color: #fff; border: none; }
    .btn-accent:hover { background: linear-gradient(135deg, #45a049, #388e3c); }
    .btn-blue { background: linear-gradient(135deg, #3b82f6, #2563eb); color: #fff; border: none; }
    .btn-blue:hover { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
    .btn[aria-pressed="true"] { background: var(--accent); color: #fff; }
    
    /* Navigation */
    .nav-section { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
      flex-wrap: wrap;
    }
    .views { display: flex; gap: 4px; }
    .month-nav { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
    }
    .month-label { 
      font-weight: 700; 
      padding: 8px 16px; 
      border-radius: 12px; 
      background: var(--chip); 
      border: var(--chip-border);
      min-width: 200px;
      text-align: center;
    }
    
    /* Search */
    input[type="search"] { 
      background: var(--panel); 
      color: var(--text); 
      border: var(--border); 
      border-radius: 12px; 
      padding: 10px 14px;
      width: 200px;
    }
    
    /* Filters */
    .filters { 
      display: flex; 
      gap: 8px; 
      flex-wrap: wrap; 
      margin: 0 0 20px 0;
    }
    .chip { 
      display: inline-flex; 
      align-items: center; 
      gap: 8px; 
      padding: 10px 16px; 
      border-radius: 25px; 
      background: var(--chip); 
      border: 2px solid transparent; 
      cursor: pointer; 
      user-select: none;
      transition: all 0.3s ease;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    .chip:hover { 
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
    }
    .chip input { display: none; }
    .chip .count { 
      font-weight: 700; 
      padding: 4px 8px; 
      border-radius: 12px; 
      background: rgba(255,255,255,.9);
      color: #333;
      font-size: 12px;
    }
    
    /* Chip specifici per categoria */
    .chip[data-category="CdC"] { 
      background: linear-gradient(135deg, #3b82f6, #2563eb); 
      color: white; 
    }
    .chip[data-category="CdC"].active { 
      border-color: #1d4ed8;
      box-shadow: 0 0 0 4px rgba(59,130,246,.2);
    }
    
    .chip[data-category="Collegio docenti"] { 
      background: linear-gradient(135deg, #10b981, #059669); 
      color: white; 
    }
    .chip[data-category="Collegio docenti"].active { 
      border-color: #047857;
      box-shadow: 0 0 0 4px rgba(16,185,129,.2);
    }
    
    .chip[data-category="Dipartimenti"] { 
      background: linear-gradient(135deg, #f59e0b, #d97706); 
      color: white; 
    }
    .chip[data-category="Dipartimenti"].active { 
      border-color: #b45309;
      box-shadow: 0 0 0 4px rgba(245,158,11,.2);
    }
    
    .chip[data-category="Scrutini"] { 
      background: linear-gradient(135deg, #8b5cf6, #7c3aed); 
      color: white; 
    }
    .chip[data-category="Scrutini"].active { 
      border-color: #6d28d9;
      box-shadow: 0 0 0 4px rgba(139,92,246,.2);
    }
    
    .chip[data-category="Altro"] { 
      background: linear-gradient(135deg, #ef4444, #dc2626); 
      color: white; 
    }
    .chip[data-category="Altro"].active { 
      border-color: #b91c1c;
      box-shadow: 0 0 0 4px rgba(239,68,68,.2);
    }
    
    .chip[data-category="Open Day"] { 
      background: linear-gradient(135deg, #ff6b6b, #ee5a52); 
      color: white; 
    }
    .chip[data-category="Open Day"].active { 
      border-color: #dc2f2f;
      box-shadow: 0 0 0 4px rgba(255,107,107,.2);
    }
    
    /* Card */
    .card { 
      background: var(--card); 
      border: var(--border); 
      border-radius: var(--radius); 
      box-shadow: var(--shadow); 
      padding: 20px;
      margin: 16px 0;
    }
    
    /* Prominent Action Buttons */
    .action-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px 0;
    }
    
    .btn-large {
      font-size: 16px;
      padding: 16px 24px;
      font-weight: 700;
      border-radius: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
      transition: all 0.3s ease;
    }
    
    .btn-large:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,.2);
    }
    
    .btn-large.btn-accent:hover {
      background: linear-gradient(135deg, #45a049, #388e3c) !important;
    }
    
    .btn-large.btn-blue:hover {
      background: linear-gradient(135deg, #2563eb, #1d4ed8) !important;
    }
    
    /* Hover specifico per il pulsante iPhone/iPad */
    a#downloadICal:hover {
      background: linear-gradient(135deg, #7c3aed, #6d28d9) !important;
    }
    
    /* Calendar Views */
    .weekdays { 
      display: grid; 
      grid-template-columns: repeat(7, 1fr); 
      gap: 8px; 
      margin: 16px 0 12px 0; 
      font-weight: 700; 
      opacity: .7;
    }
    .grid-month { 
      display: grid; 
      grid-template-columns: repeat(7, 1fr); 
      gap: 10px;
    }
    .day { 
      min-height: 120px; 
      border: var(--border); 
      border-radius: 12px; 
      padding: 8px; 
      position: relative; 
      background: #fafafa;
    }
    .day.has-events {
      background: rgba(239,68,68,.1);
      border-color: rgba(239,68,68,.3);
      font-weight: 600;
    }
    .day .date { 
      position: absolute; 
      top: 8px; 
      right: 10px; 
      font-weight: 800; 
      font-size: 14px; 
      opacity: .75;
    }
    .day.today { 
      outline: 3px solid var(--accent); 
      background: linear-gradient(135deg, rgba(76,175,80,.2), rgba(76,175,80,.15));
      box-shadow: 0 0 0 1px var(--accent), 0 8px 25px rgba(76,175,80,.3);
      position: relative;
      transform: scale(1.02);
    }
    .day.today .date {
      color: #ffffff;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      font-weight: 900;
      font-size: 18px;
      padding: 4px 8px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(76,175,80,.4);
      position: absolute;
      top: 6px;
      right: 6px;
      border: 2px solid #ffffff;
    }
    .day.today::before {
      content: "OGGI";
      position: absolute;
      top: 8px;
      left: 8px;
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      color: white;
      font-size: 10px;
      font-weight: 800;
      padding: 2px 6px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(255,107,107,.3);
    }
    .day.other-month { 
      opacity: .4; 
    }
    
    /* Events */
    .event { 
      margin-top: 8px; 
      padding: 6px 10px; 
      border-radius: 8px; 
      font-size: 13px; 
      line-height: 1.3; 
      cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }
    .event:hover { 
      transform: translateY(-1px); 
      filter: brightness(1.1); 
    }
    
    /* Event Categories */
    .cat-CdC { background: rgba(59,130,246,.25); border-color: rgba(59,130,246,.5); }
    .cat-Collegio { background: rgba(76,175,80,.25); border-color: rgba(76,175,80,.5); }
    .cat-Dipartimenti { background: rgba(245,158,11,.25); border-color: rgba(245,158,11,.5); }
    .cat-Scrutini { background: rgba(139,92,246,.25); border-color: rgba(139,92,246,.5); }
    .cat-Altro { background: rgba(239,68,68,.25); border-color: rgba(239,68,68,.5); color: #333; font-weight: 600; }
    .cat-OpenDay { background: rgba(255,107,107,.25); border-color: rgba(255,107,107,.5); color: #333; font-weight: 600; }
    
    /* Weekly View */
    .week-strip { 
      display: flex; 
      gap: 12px; 
      overflow-x: auto; 
      padding-bottom: 8px;
    }
    .week-col { 
      min-width: 250px; 
      flex: 0 0 250px;
    }
    .week-col.today {
      transform: scale(1.02);
      box-shadow: 0 8px 25px rgba(76,175,80,.2);
      border: 2px solid var(--accent);
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(76,175,80,.1), rgba(76,175,80,.05));
    }
    .week-header { 
      font-weight: 800; 
      margin-bottom: 12px; 
      text-align: center; 
      padding: 8px; 
      border-radius: 8px; 
      background: var(--chip);
    }
    .week-col.today .week-header {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: white;
      position: relative;
    }
    .week-col.today .week-header::after {
      content: "OGGI";
      position: absolute;
      top: -8px;
      right: -8px;
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      color: white;
      font-size: 10px;
      font-weight: 800;
      padding: 2px 6px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(255,107,107,.3);
    }
    
    /* Yearly View */
    .year-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
      gap: 16px;
      max-width: 1400px;
    }
    
    /* Optimal layout for 10 months (school year) */
    @media (min-width: 1200px) {
      .year-grid {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    
    @media (max-width: 1199px) and (min-width: 768px) {
      .year-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 767px) {
      .year-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .mini-month { 
      padding: 16px; 
      border: var(--border); 
      border-radius: 12px; 
      background: var(--panel);
    }
    .mini-month h4 { 
      margin: 0 0 12px 0; 
      text-align: center; 
      font-weight: 800;
    }
    .mini-month table { 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 13px;
    }
    .mini-month th, .mini-month td { 
      width: 14.28%; 
      text-align: center; 
      padding: 4px 2px;
      font-size: 11px;
      vertical-align: top;
      height: 30px;
    }
    .mini-month th { 
      font-weight: 700; 
      opacity: .7; 
      border-bottom: var(--border);
      height: auto;
    }
    .mini-month .has-event { 
      background: var(--red); 
      color: #fff; 
      border-radius: 4px; 
      font-weight: 600;
      font-size: 9px;
      line-height: 1.1;
    }
    .mini-month .today { 
      outline: 2px solid var(--accent); 
      border-radius: 6px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #ffffff;
      font-weight: 900;
      box-shadow: 0 2px 8px rgba(76,175,80,.4);
      position: relative;
    }
    
    /* Modal */
    .modal-backdrop { 
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,.6); 
      display: none; 
      align-items: center; 
      justify-content: center; 
      z-index: 100;
    }
    .modal { 
      background: var(--card); 
      border: var(--border); 
      border-radius: 16px; 
      box-shadow: var(--shadow); 
      max-width: 500px; 
      width: 92%; 
      padding: 24px; 
      position: relative;
    }
    .modal h3 { 
      margin: 0 0 8px 0; 
      font-size: 20px;
    }
    .modal .meta { 
      color: var(--muted); 
      margin-bottom: 16px; 
      font-size: 14px;
    }
    .modal .actions { 
      display: flex; 
      gap: 8px; 
      flex-wrap: wrap; 
      margin-top: 20px;
    }
    .close-x { 
      position: absolute; 
      top: 16px; 
      right: 20px; 
      cursor: pointer; 
      font-size: 20px; 
      font-weight: 800; 
      opacity: .7;
    }
    .close-x:hover { opacity: 1; }
    
    /* FAQ Styles */
    .faq-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .faq-item {
      border: var(--border);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s ease;
    }
    
    .faq-item:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
    }
    
    .faq-question {
      padding: 16px 20px;
      background: var(--panel);
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      list-style: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.2s ease;
      border-bottom: var(--border);
    }
    
    .faq-question:hover {
      background: rgba(76,175,80,.05);
    }
    
    .faq-question::after {
      content: "▼";
      font-size: 12px;
      opacity: 0.6;
      transition: transform 0.2s ease;
    }
    
    .faq-item[open] .faq-question::after {
      transform: rotate(180deg);
    }
    
    .faq-item[open] .faq-question {
      background: rgba(76,175,80,.08);
      border-bottom-color: rgba(76,175,80,.2);
    }
    
    .faq-answer {
      padding: 20px;
      background: var(--card);
      line-height: 1.6;
    }
    
    .faq-answer p {
      margin: 0 0 12px 0;
    }
    
    .faq-answer p:last-child {
      margin-bottom: 0;
    }
    
    .faq-answer ul {
      margin: 8px 0;
      padding-left: 20px;
    }
    
    .faq-answer li {
      margin-bottom: 6px;
    }
    
    .faq-answer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }
    
    .faq-answer a:hover {
      text-decoration: underline;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .top-inner { flex-direction: column; gap: 8px; }
      .nav-section { justify-content: center; }
      input[type="search"] { width: 150px; }
      .day { min-height: 100px; padding: 8px; }
      .grid-month { gap: 6px; }
      .week-col { min-width: 200px; flex: 0 0 200px; }
      .action-buttons { flex-direction: column; align-items: center; }
      .btn-large { width: 100%; max-width: 300px; justify-content: center; }
    }
    
    /* Print Styles */
    @media print {
      .topbar { display: none !important; }
      footer { display: none !important; }
      .action-buttons { display: none !important; }
      .faq-container { display: none !important; }
      body { background: #fff; color: #000; }
      .card { box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; }
      .btn { display: none; }
      .modal-backdrop { display: none !important; }
    }
    
    .text-center { text-align: center; }
    .mt-4 { margin-top: 16px; }
    .mb-4 { margin-bottom: 16px; }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="top-inner">
      <div class="brand">
        <span class="dot"></span> 
        IIS Mendel · Piano delle Attività 2025-2026
      </div>
      
      <div class="nav-section">
        <div class="month-nav">
          <button id="prev" class="btn" title="Precedente">‹</button>
          <div id="monthLabel" class="month-label">—</div>
          <button id="next" class="btn" title="Successivo">›</button>
        </div>
        
        <div class="views">
          <button class="btn" data-view="monthly" aria-pressed="true">Mensile</button>
          <button class="btn" data-view="weekly">Settimanale</button>
          <button class="btn" data-view="yearly">Annuale</button>
        </div>
      </div>
      
      <div class="controls">
        <input id="search" type="search" placeholder="Cerca evento...">
        <button id="todayBtn" class="btn" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52); color: white; font-weight: 700; border: none;">📍 Oggi</button>
        <button id="exportPdf" class="btn btn-accent">Esporta PDF</button>
        <button id="fullscreenToggle" class="btn" aria-pressed="false">⛶</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Pulsanti prominenti per accesso e sincronizzazione -->
    <div class="action-buttons">
      <button id="openFullscreenBtn" class="btn btn-accent btn-large">
        📅 Apri a tutto schermo
      </button>
      <button id="syncGoogleCalendar" class="btn btn-blue btn-large">
        🔄 Sincronizza con Google Calendar
      </button>
      <a id="downloadICal" class="btn btn-large" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: #fff; text-decoration: none;">
        📱 Scarica per iPhone/iPad
      </a>
    </div>
    
    <div style="text-align: center; margin: 0 0 20px 0;">
      <p style="margin: 0; font-size: 14px; color: var(--muted);">
        Sincronizza il calendario con il tuo dispositivo per ricevere notifiche automatiche degli eventi scolastici e Open Day
      </p>
    </div>
    
    <!-- CALENDARIO PRINCIPALE -->
    <div class="card">
      <div class="filters" id="filters"></div>
      <div id="calendarArea"></div>
    </div>
    
    <div class="text-center mt-4">
      <small style="opacity: 0.7;">
        📖 Premi <strong>F</strong> per la modalità schermo intero • 
        🖨️ Usa <strong>Ctrl+P</strong> per stampare
      </small>
    </div>

    <!-- FAQ Section - Solo Digitale e Accesso -->
    <div class="card" style="margin-top: 32px;">
      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
        <div style="width: 32px; height: 32px; border-radius: 50%; background: rgba(59,130,246,.1); display: flex; align-items: center; justify-content: center;">
          <span style="font-size: 18px;">📱</span>
        </div>
        <h2 style="margin: 0; font-size: 20px; font-weight: 800;">DIGITALE E ACCESSO</h2>
      </div>
      
      <div class="faq-container">
        <details class="faq-item">
          <summary class="faq-question">❓ Posso sincronizzare questo calendario con Google Calendar?</summary>
          <div class="faq-answer">
            <p>Sì, puoi sincronizzare facilmente il calendario:</p>
            <ul>
              <li><strong>Google Calendar:</strong> Usa il pulsante "Sincronizza con Google Calendar" in alto per importare tutti gli eventi</li>
              <li><strong>Eventi singoli:</strong> Clicca sui singoli eventi e usa il link "Google Calendar" nel popup</li>
              <li><strong>Aggiornamenti automatici:</strong> Una volta sincronizzato, riceverai notifiche per tutti gli eventi scolastici</li>
            </ul>
          </div>
        </details>

        <details class="faq-item">
          <summary class="faq-question">❓ Il calendario è accessibile da mobile?</summary>
          <div class="faq-answer">
            <p>Sì, è completamente ottimizzato per dispositivi mobili:</p>
            <ul>
              <li><strong>Design responsive:</strong> Si adatta automaticamente a smartphone e tablet</li>
              <li><strong>Touch-friendly:</strong> Tutti i controlli sono ottimizzati per il tocco</li>
              <li><strong>Modalità schermo intero:</strong> Per un'esperienza di visualizzazione ottimale</li>
              <li><strong>Download iCal:</strong> Usa il pulsante "Scarica per iPhone/iPad" per aggiungere agli app native</li>
            </ul>
          </div>
        </details>

        <details class="faq-item">
          <summary class="faq-question">❓ Posso stampare solo alcuni mesi?</summary>
          <div class="faq-answer">
            <p>Sì, puoi stampare selettivamente:</p>
            <ul>
              <li><strong>Vista specifica:</strong> Seleziona la vista desiderata (mensile, settimanale, annuale)</li>
              <li><strong>Mese specifico:</strong> Naviga al mese che vuoi stampare</li>
              <li><strong>Stampa:</strong> Usa <strong>Ctrl+P</strong> (o Cmd+P su Mac) per stampare</li>
              <li><strong>Esporta PDF:</strong> Usa il pulsante "Esporta PDF" per salvare invece di stampare</li>
            </ul>
          </div>
        </details>

        <details class="faq-item">
          <summary class="faq-question">❓ Come posso conoscere le date degli Open Day?</summary>
          <div class="faq-answer">
            <p>Gli Open Day sono inclusi nel calendario e facilmente identificabili:</p>
            <ul>
              <li><strong>Filtro categoria:</strong> Usa il filtro "Open Day" per visualizzare solo questi eventi</li>
              <li><strong>Pulsante dedicato:</strong> Clicca su "Open Day / Orientamento" per maggiori informazioni</li>
              <li><strong>Notifiche:</strong> Sincronizza il calendario per ricevere promemoria automatici</li>
              <li><strong>Dettagli eventi:</strong> Clicca sui singoli eventi per orari e descrizioni complete</li>
            </ul>
          </div>
        </details>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer style="margin-top: 40px; padding: 20px; text-align: center; border-top: var(--border); background: var(--panel); color: var(--muted); font-size: 14px;">
    <p style="margin: 0;">
      <strong>Webapp sviluppata dall'IIS MENDEL</strong><br>
      Via Ferrazzi 15 - 20035 Villa Cortese (MI)
    </p>
  </footer>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="close-x" id="modalClose">✕</div>
      <h3 id="modalTitle"></h3>
      <div class="meta" id="modalMeta"></div>
      <div id="modalDescription"></div>
      <div class="actions">
        <a id="gcalLink" class="btn btn-accent" target="_blank" rel="noopener">📅 Google Calendar</a>
        <button id="closeBtn" class="btn">Chiudi</button>
      </div>
    </div>
  </div>

<script>
// =============================================================================
// EVENTI - Solo Festività Anno Scolastico 2025-2026
// =============================================================================
const EVENTS = [
  { date: "2025-11-01", title: "Ognissanti", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2025-12-08", title: "Immacolata Concezione", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2025-12-25", title: "Natale", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2025-12-26", title: "Santo Stefano", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2026-01-01", title: "Capodanno", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2026-01-06", title: "Epifania", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2026-04-06", title: "Lunedì di Pasqua", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2026-04-25", title: "Festa della Liberazione", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2026-05-01", title: "Festa del Lavoro", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  { date: "2026-05-08", title: "Santo Patrono - Villa Cortese", cat: "Altro", description: "Santo Patrono di Villa Cortese - Scuole chiuse" },
  { date: "2026-06-02", title: "Festa della Repubblica", cat: "Altro", description: "Festa nazionale - Scuole chiuse" },
  
  // === EVENTI OPEN DAY / ORIENTAMENTO ===
  { date: "2025-11-16", title: "Open Day - Presentazione Istituto", time: "15:00", cat: "Open Day", description: "Presentazione dell'offerta formativa e visita ai laboratori dell'IIS Mendel" },
  { date: "2025-12-14", title: "Open Day - Laboratori Aperti", time: "15:00", cat: "Open Day", description: "Laboratori di Agraria, Biotecnologie e Chimica aperti per le famiglie" },
  { date: "2026-01-18", title: "Open Day - Orientamento in Entrata", time: "15:00", cat: "Open Day", description: "Giornata dedicata all'orientamento per gli studenti di terza media" },
  
  // === NOTE PER FUTURE PROGRAMMAZIONI ===
  // Qui potranno essere aggiunte le attività quando saranno programmate:
  // { date: "2025-09-01", title: "Collegio docenti apertura", time: "15:00", cat: "Collegio docenti", description: "..." },
  // { date: "2025-10-15", title: "CdC ottobre", time: "14:30", cat: "CdC", description: "..." },
  // { date: "2025-11-20", title: "Riunione Dipartimenti", time: "15:00", cat: "Dipartimenti", description: "..." },
  // { date: "2026-01-20", title: "Scrutini primo periodo", time: "14:30", cat: "Scrutini", description: "..." },
];

const IT_MONTHS = ["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];
const IT_WEEKDAYS_SHORT = ["Dom","Lun","Mar","Mer","Gio","Ven","Sab"];

const CATEGORY_COLORS = {
  "CdC": "cat-CdC",
  "Collegio docenti": "cat-Collegio",
  "Dipartimenti": "cat-Dipartimenti",
  "Scrutini": "cat-Scrutini", 
  "Altro": "cat-Altro",
  "Open Day": "cat-OpenDay"
};

let currentView = "monthly";
let currentDate = new Date(2025, 8, 1); // Settembre 2025
let activeCategories = new Set(Object.keys(CATEGORY_COLORS));
let searchTerm = "";

// =============================================================================
// UTILITIES
// =============================================================================
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

function formatDate(date) {
  return date.toISOString().slice(0, 10);
}

function parseDate(dateString) {
  const [year, month, day] = dateString.split("-").map(Number);
  return new Date(year, month - 1, day);
}

function isToday(date) {
  const today = new Date();
  return formatDate(date) === formatDate(today);
}

function getEventsForDate(dateString) {
  return EVENTS.filter(event => {
    const matchesDate = event.date === dateString;
    const matchesCategory = activeCategories.has(event.cat);
    const matchesSearch = !searchTerm || 
      event.title.toLowerCase().includes(searchTerm.toLowerCase());
    return matchesDate && matchesCategory && matchesSearch;
  });
}

function countEventsByCategory() {
  const counts = {};
  EVENTS.forEach(event => {
    counts[event.cat] = (counts[event.cat] || 0) + 1;
  });
  return counts;
}

function abbreviateEvent(title) {
  const abbreviations = {
    "Ognissanti": "Ogn",
    "Immacolata": "Imm", 
    "Natale": "Nat",
    "Santo Stefano": "S.Stef",
    "Capodanno": "Cap",
    "Epifania": "Epif",
    "Lunedì di Pasqua": "Pasq",
    "Festa della Liberazione": "Liber",
    "Festa del Lavoro": "Lav",
    "Santo Patrono": "S.Pat",
    "Festa della Repubblica": "Rep",
    "Collegio docenti": "CD",
    "Consigli di classe": "CdC", 
    "CdC": "CdC",
    "Dipartimenti": "Dip",
    "Scrutini": "Scrut",
    "Open Day": "OD",
    "Orientamento": "Orient"
  };
  
  for (const [key, abbr] of Object.entries(abbreviations)) {
    if (title.includes(key)) {
      return abbr;
    }
  }
  
  return title.substring(0, 4);
}

// =============================================================================
// CALENDAR SYNC FUNCTIONS
// =============================================================================
function generateICalData() {
  const calendarName = "IIS Mendel - Piano delle Attività 2025-2026";
  const calendarDescription = "Piano delle Attività scolastico IIS Mendel per l'anno 2025-2026";
  
  let icalData = [
    "BEGIN:VCALENDAR",
    "VERSION:2.0",
    "PRODID:-//IIS Mendel//Piano delle Attività//IT",
    `X-WR-CALNAME:${calendarName}`,
    `X-WR-CALDESC:${calendarDescription}`,
    "CALSCALE:GREGORIAN",
    "METHOD:PUBLISH"
  ];

  EVENTS.forEach(event => {
    const eventDate = parseDate(event.date);
    const dtStart = eventDate.toISOString().replace(/[-:]/g, '').split('T')[0];
    const dtEnd = new Date(eventDate.getTime() + 24 * 60 * 60 * 1000).toISOString().replace(/[-:]/g, '').split('T')[0];
    
    icalData.push(
      "BEGIN:VEVENT",
      `UID:${event.date}-${event.title.replace(/\s+/g, '-')}@iismendel.edu.it`,
      `DTSTART;VALUE=DATE:${dtStart}`,
      `DTEND;VALUE=DATE:${dtEnd}`,
      `SUMMARY:${event.title}`,
      `DESCRIPTION:${event.description || ''}`,
      `CATEGORIES:${event.cat}`,
      "STATUS:CONFIRMED",
      "TRANSP:OPAQUE",
      "END:VEVENT"
    );
  });

  icalData.push("END:VCALENDAR");
  return icalData.join('\r\n');
}

function downloadICalFile() {
  const icalData = generateICalData();
  const blob = new Blob([icalData], { type: 'text/calendar;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = 'IIS-Mendel-Piano-Attivita-2025-2026.ics';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  URL.revokeObjectURL(url);
}

function openGoogleCalendarImport() {
  // Genera il link per importare su Google Calendar
  const calendarUrl = encodeURIComponent(window.location.href);
  const googleCalendarUrl = `https://calendar.google.com/calendar/render?cid=${calendarUrl}`;
  
  // Alternativa: usa il link diretto per aggiungere un calendario
  const addCalendarUrl = 'https://calendar.google.com/calendar/u/0/r/settings/addbyurl';
  window.open(addCalendarUrl, '_blank');
  
  // Mostra istruzioni all'utente
  setTimeout(() => {
    alert(`Per sincronizzare con Google Calendar:
    
1. Si aprirà la pagina delle impostazioni di Google Calendar
2. Incolla questo URL nel campo "URL del calendario":
   ${window.location.href}
3. Clicca "Aggiungi calendario"
   
In alternativa, scarica il file .ics cliccando su "Scarica per iPhone/iPad" e importalo manualmente.`);
  }, 500);
}

// =============================================================================
// FILTERS RENDERING
// =============================================================================
function renderFilters() {
  const counts = countEventsByCategory();
  const container = $("#filters");
  container.innerHTML = "";
  
  Object.keys(CATEGORY_COLORS).forEach(category => {
    const count = counts[category] || 0;
    
    const chip = document.createElement("label");
    chip.className = `chip ${activeCategories.has(category) ? "active" : ""}`;
    chip.setAttribute('data-category', category);
    chip.innerHTML = `
      <input type="checkbox" ${activeCategories.has(category) ? "checked" : ""}>
      <span>${category}</span>
      <span class="count">${count}</span>
    `;
    
    chip.addEventListener("click", () => {
      if (activeCategories.has(category)) {
        activeCategories.delete(category);
      } else {
        activeCategories.add(category);
      }
      render();
    });
    
    container.appendChild(chip);
  });
}

// =============================================================================
// CALENDAR VIEWS
// =============================================================================
function renderMonthlyView(date) {
  const container = document.createElement("div");
  
  // Weekdays header
  const weekdays = document.createElement("div");
  weekdays.className = "weekdays";
  IT_WEEKDAYS_SHORT.forEach(day => {
    const dayEl = document.createElement("div");
    dayEl.textContent = day;
    weekdays.appendChild(dayEl);
  });
  container.appendChild(weekdays);
  
  // Calendar grid
  const grid = document.createElement("div");
  grid.className = "grid-month";
  
  const year = date.getFullYear();
  const month = date.getMonth();
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - firstDay.getDay());
  
  for (let i = 0; i < 42; i++) {
    const currentDay = new Date(startDate);
    currentDay.setDate(startDate.getDate() + i);
    
    const dayEl = document.createElement("div");
    dayEl.className = "day";
    
    if (currentDay.getMonth() !== month) {
      dayEl.classList.add("other-month");
    }
    
    if (isToday(currentDay)) {
      dayEl.classList.add("today");
    }
    
    // Check if this day has events
    const dateString = formatDate(currentDay);
    const dayEvents = getEventsForDate(dateString);
    
    if (dayEvents.length > 0) {
      dayEl.classList.add("has-events");
    }
    
    // Date number
    const dateEl = document.createElement("div");
    dateEl.className = "date";
    dateEl.textContent = currentDay.getDate();
    dayEl.appendChild(dateEl);
    
    // Events for this day
    dayEvents.forEach(event => {
      const eventEl = document.createElement("div");
      eventEl.className = `event ${CATEGORY_COLORS[event.cat] || ""}`;
      eventEl.textContent = event.title;
      eventEl.addEventListener("click", () => openModal(event));
      dayEl.appendChild(eventEl);
    });
    
    grid.appendChild(dayEl);
  }
  
  container.appendChild(grid);
  return container;
}

function renderWeeklyView(date) {
  const container = document.createElement("div");
  
  // Get start of week (Sunday)
  const startOfWeek = new Date(date);
  startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
  
  const endOfWeek = new Date(startOfWeek);
  endOfWeek.setDate(endOfWeek.getDate() + 6);
  
  // Week label
  const weekLabel = document.createElement("div");
  weekLabel.className = "text-center mb-4";
  weekLabel.innerHTML = `<strong>Settimana dal ${startOfWeek.toLocaleDateString('it-IT')} al ${endOfWeek.toLocaleDateString('it-IT')}</strong>`;
  container.appendChild(weekLabel);
  
  // Week strip
  const strip = document.createElement("div");
  strip.className = "week-strip";
  
  for (let i = 0; i < 7; i++) {
    const currentDay = new Date(startOfWeek);
    currentDay.setDate(startOfWeek.getDate() + i);
    
    const col = document.createElement("div");
    col.className = "day week-col";
    
    if (isToday(currentDay)) {
      col.classList.add("today");
    }
    
    // Day header
    const header = document.createElement("div");
    header.className = "week-header";
    header.innerHTML = `
      <div>${IT_WEEKDAYS_SHORT[currentDay.getDay()]}</div>
      <div>${currentDay.getDate()}/${currentDay.getMonth() + 1}</div>
    `;
    col.appendChild(header);
    
    // Events for this day
    const dateString = formatDate(currentDay);
    const dayEvents = getEventsForDate(dateString);
    
    dayEvents.forEach(event => {
      const eventEl = document.createElement("div");
      eventEl.className = `event ${CATEGORY_COLORS[event.cat] || ""}`;
      eventEl.textContent = event.title;
      eventEl.addEventListener("click", () => openModal(event));
      col.appendChild(eventEl);
    });
    
    strip.appendChild(col);
  }
  
  container.appendChild(strip);
  return container;
}

function renderYearlyView(date) {
  const container = document.createElement("div");
  container.className = "year-grid";
  
  // Anno scolastico: settembre 2025 - giugno 2026
  const schoolYearMonths = [
    // Settembre - Dicembre 2025
    { month: 8, year: 2025 },  // Settembre (mese 8)
    { month: 9, year: 2025 },  // Ottobre
    { month: 10, year: 2025 }, // Novembre
    { month: 11, year: 2025 }, // Dicembre
    // Gennaio - Giugno 2026
    { month: 0, year: 2026 },  // Gennaio (mese 0)
    { month: 1, year: 2026 },  // Febbraio
    { month: 2, year: 2026 },  // Marzo
    { month: 3, year: 2026 },  // Aprile
    { month: 4, year: 2026 },  // Maggio
    { month: 5, year: 2026 }   // Giugno
  ];
  
  schoolYearMonths.forEach(({ month, year }) => {
    const monthCard = document.createElement("div");
    monthCard.className = "mini-month";
    
    // Month header
    const header = document.createElement("h4");
    header.textContent = `${IT_MONTHS[month]} ${year}`;
    monthCard.appendChild(header);
    
    // Calendar table
    const table = document.createElement("table");
    
    // Weekdays header
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    IT_WEEKDAYS_SHORT.forEach(day => {
      const th = document.createElement("th");
      th.textContent = day;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);
    
    // Calendar body
    const tbody = document.createElement("tbody");
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    for (let week = 0; week < 6; week++) {
      const row = document.createElement("tr");
      
      for (let day = 0; day < 7; day++) {
        const currentDay = new Date(startDate);
        currentDay.setDate(startDate.getDate() + week * 7 + day);
        
        const td = document.createElement("td");
        
        if (currentDay.getMonth() === month) {
          const dayNum = currentDay.getDate();
          
          if (isToday(currentDay)) {
            td.classList.add("today");
          }
          
          const dateString = formatDate(currentDay);
          const dayEvents = getEventsForDate(dateString);
          
          if (dayEvents.length > 0) {
            td.classList.add("has-event");
            const abbr = abbreviateEvent(dayEvents[0].title);
            td.innerHTML = `${dayNum}<br><small>${abbr}</small>`;
          } else {
            td.textContent = dayNum;
          }
        }
        
        row.appendChild(td);
      }
      
      tbody.appendChild(row);
    }
    
    table.appendChild(tbody);
    monthCard.appendChild(table);
    container.appendChild(monthCard);
  });
  
  return container;
}

// =============================================================================
// MODAL MANAGEMENT
// =============================================================================
function openModal(event) {
  $("#modalTitle").textContent = event.title;
  
  const eventDate = parseDate(event.date);
  const dateFormatted = eventDate.toLocaleDateString('it-IT', {
    weekday: 'long',
    year: 'numeric', 
    month: 'long', 
    day: 'numeric'
  });
  
  $("#modalMeta").textContent = dateFormatted;
  $("#modalDescription").innerHTML = event.description ? 
    `<p style="margin: 12px 0; color: var(--muted);">${event.description}</p>` : "";
    
  // Generate Google Calendar link for individual event
  const gcalDate = event.date.replace(/-/g, '');
  const gcalUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(event.title)}&dates=${gcalDate}/${gcalDate}&details=${encodeURIComponent(event.description || '')}`;
  $("#gcalLink").href = gcalUrl;
  
  $("#modalBackdrop").style.display = "flex";
}

function closeModal() {
  $("#modalBackdrop").style.display = "none";
}

// =============================================================================
// NAVIGATION
// =============================================================================
function updateMonthLabel() {
  let label;
  if (currentView === "monthly") {
    label = `${IT_MONTHS[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
  } else if (currentView === "weekly") {
    const startOfWeek = new Date(currentDate);
    startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(endOfWeek.getDate() + 6);
    label = `${startOfWeek.getDate()}/${startOfWeek.getMonth() + 1} - ${endOfWeek.getDate()}/${endOfWeek.getMonth() + 1}/${endOfWeek.getFullYear()}`;
  } else {
    label = `Anno Scolastico 2025-2026`;
  }
  $("#monthLabel").textContent = label;
}

function navigatePrevious() {
  if (currentView === "yearly") {
    // Vista annuale fissa per anno scolastico 2025-2026
    return;
  }
  
  if (currentView === "monthly") {
    currentDate.setMonth(currentDate.getMonth() - 1);
  } else if (currentView === "weekly") {
    currentDate.setDate(currentDate.getDate() - 7);
  }
  render();
}

function navigateNext() {
  if (currentView === "yearly") {
    // Vista annuale fissa per anno scolastico 2025-2026
    return;
  }
  
  if (currentView === "monthly") {
    currentDate.setMonth(currentDate.getMonth() + 1);
  } else if (currentView === "weekly") {
    currentDate.setDate(currentDate.getDate() + 7);
  }
  render();
}

function goToToday() {
  const today = new Date();
  currentDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
  render();
}

// =============================================================================
// MAIN RENDER FUNCTION
// =============================================================================
function render() {
  updateMonthLabel();
  renderFilters();
  
  const calendarArea = $("#calendarArea");
  calendarArea.innerHTML = "";
  
  let viewContent;
  if (currentView === "monthly") {
    viewContent = renderMonthlyView(currentDate);
  } else if (currentView === "weekly") {
    viewContent = renderWeeklyView(currentDate);
  } else {
    viewContent = renderYearlyView(currentDate);
  }
  
  calendarArea.appendChild(viewContent);
}

// =============================================================================
// EXPORT PDF
// =============================================================================
function exportToPdf() {
  const originalTitle = document.title;
  document.title = `Piano delle Attività IIS Mendel - ${$("#monthLabel").textContent}`;
  
  const elementsToHide = $$('.btn, input[type="search"], .modal-backdrop, .action-buttons');
  elementsToHide.forEach(el => el.style.display = 'none');
  
  window.print();
  
  document.title = originalTitle;
  elementsToHide.forEach(el => el.style.display = '');
}

// =============================================================================
// FULLSCREEN
// =============================================================================
function initializeFullscreen() {
  const btn = $("#fullscreenToggle");
  
  function isFullscreen() {
    return !!(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement);
  }
  
  function requestFullscreen() {
    const el = document.documentElement;
    if (el.requestFullscreen) return el.requestFullscreen();
    if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
    if (el.msRequestFullscreen) return el.msRequestFullscreen();
  }
  
  function exitFullscreen() {
    if (document.exitFullscreen) return document.exitFullscreen();
    if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
    if (document.msExitFullscreen) return document.msExitFullscreen();
  }
  
  function updateButton() {
    const isFS = isFullscreen();
    btn.setAttribute('aria-pressed', isFS ? 'true' : 'false');
    btn.title = isFS ? 'Esci da schermo intero' : 'Schermo intero';
  }
  
  btn.addEventListener("click", () => {
    if (!isFullscreen()) {
      requestFullscreen();
    } else {
      exitFullscreen();
    }
  });
  
  document.addEventListener("fullscreenchange", updateButton);
  document.addEventListener("webkitfullscreenchange", updateButton);
  document.addEventListener("msfullscreenchange", updateButton);
  
  document.addEventListener("keydown", (e) => {
    if (e.key && e.key.toLowerCase() === 'f' && !e.ctrlKey && !e.altKey && !e.metaKey) {
      e.preventDefault();
      btn.click();
    }
  });
  
  updateButton();
}

// =============================================================================
// EVENT LISTENERS
// =============================================================================
function initializeEventListeners() {
  // Navigation
  $("#prev").addEventListener("click", navigatePrevious);
  $("#next").addEventListener("click", navigateNext);
  $("#todayBtn").addEventListener("click", goToToday);
  
  // View switching
  $$('.views .btn').forEach(btn => {
    btn.addEventListener('click', () => {
      $$('.views .btn').forEach(b => b.setAttribute('aria-pressed', 'false'));
      btn.setAttribute('aria-pressed', 'true');
      currentView = btn.dataset.view;
      render();
    });
  });
  
  // Search
  $("#search").addEventListener("input", (e) => {
    searchTerm = e.target.value.trim();
    render();
  });
  
  // Export
  $("#exportPdf").addEventListener("click", exportToPdf);
  
  // Sync buttons
  $("#syncGoogleCalendar").addEventListener("click", openGoogleCalendarImport);
  $("#downloadICal").addEventListener("click", downloadICalFile);
  
  // Fullscreen buttons
  $("#openFullscreenBtn").addEventListener("click", () => {
    const el = document.documentElement;
    if (el.requestFullscreen) return el.requestFullscreen();
    if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
    if (el.msRequestFullscreen) return el.msRequestFullscreen();
  });
  
  // Modal
  $("#modalClose").addEventListener("click", closeModal);
  $("#closeBtn").addEventListener("click", closeModal);
  $("#modalBackdrop").addEventListener("click", (e) => {
    if (e.target.id === "modalBackdrop") closeModal();
  });
  
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && $("#modalBackdrop").style.display === "flex") {
      closeModal();
    }
  });
}

// =============================================================================
// INITIALIZATION
// =============================================================================
function initialize() {
  initializeFullscreen();
  initializeEventListeners();
  render();
}

document.addEventListener("DOMContentLoaded", initialize);
</script>
</body>
</html>
